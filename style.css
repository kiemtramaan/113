// Lấy canvas và thiết lập kích thước ban đầu
const canvas = document.getElementById('matrix');
const ctx = canvas.getContext('2d');
let W = window.innerWidth;
let H = window.innerHeight;
canvas.width = W;
canvas.height = H;

// Chuỗi ký tự cho hiệu ứng “Matrix Rain”
const letters = "アァイィウヴエカガキギクグケゲコゴサザシジスズセゼソゾタダチッヂヅテデトドナニヌネノハバパヒビピフブプヘベペホボポマミムメモヤユラリルレロワヲンABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";

const fontSize = 14;
let columns = Math.floor(W / fontSize);
let drops = new Array(columns).fill(1);

// Hàm vẽ hiệu ứng “Matrix Rain”
function drawMatrix() {
  // Tô một lớp đen bán trong suốt lên toàn canvas để tạo “vệt mờ”
  ctx.fillStyle = "rgba(0, 0, 0, 0.05)";
  ctx.fillRect(0, 0, W, H);

  ctx.fillStyle = "#0F0"; // Màu chữ xanh lá
  ctx.font = fontSize + "px 'Share Tech Mono'";

  for (let i = 0; i < drops.length; i++) {
    const text = letters.charAt(Math.floor(Math.random() * letters.length));
    ctx.fillText(text, i * fontSize, drops[i] * fontSize);

    if (drops[i] * fontSize > H && Math.random() > 0.975) {
      drops[i] = 0;
    }
    drops[i]++;
  }
}

// Chạy animation: mỗi 30ms vẽ lại một frame
setInterval(drawMatrix, 30);

// Khi đổi kích thước trình duyệt, cập nhật lại W, H, columns, drops
window.addEventListener('resize', () => {
  W = window.innerWidth;
  H = window.innerHeight;
  canvas.width = W;
  canvas.height = H;
  columns = Math.floor(W / fontSize);
  drops = new Array(columns).fill(1);
});

// Hàm tạo chuỗi ngẫu nhiên độ dài 10 (chứa chữ hoa, chữ thường, số)
function generateRandomCode(length = 10) {
  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
  let result = '';
  for (let i = 0; i < length; i++) {
    result += chars.charAt(Math.floor(Math.random() * chars.length));
  }
  return result;
}

// Hàm xử lý khi nhấn nút “BẮT ĐẦU”
function submitForm() {
  const phone = document.getElementById('phone').value.trim();
  const idname = document.getElementById('idname').value.trim();
  const gamename = document.getElementById('gamename').value.trim();
  const messageDiv = document.getElementById('message');
  const successSound = document.getElementById('successSound');

  // Nếu bất kỳ trường nào trống, hiện thông báo màu đỏ
  if (!phone || !idname || !gamename) {
    messageDiv.textContent = "Vui lòng điền đầy đủ Số điện thoại, ID tài khoản và Cổng game.";
    messageDiv.style.color = "#ff6666";
    return;
  }

  // Nếu Cổng game là St666 hoặc Ae888
  if (gamename === "St666" || gamename === "Ae888") {
    // Hiển thị đếm ngược 5s trước khi hiện thông báo
    let countdown = 5;
    messageDiv.style.color = "#66ff66";
    messageDiv.textContent = `Vui lòng chờ ${countdown} giây ...`;
    const intervalID = setInterval(() => {
      countdown--;
      if (countdown > 0) {
        messageDiv.textContent = `Vui lòng chờ ${countdown} giây ...`;
      } else {
        clearInterval(intervalID);
        messageDiv.textContent = "TÀI KHOẢN KHÔNG CÓ MÃ ẨN";
        messageDiv.style.color = "#66ff66";
      }
    }, 1000);
    return;
  }

  // Trường hợp khác (không phải St666 hoặc Ae888)
  // Phát âm thanh và tạo mã ẩn ngẫu nhiên
  successSound.play();
  const randomCode = generateRandomCode(10);
  messageDiv.style.color = "#66ff66";
  messageDiv.textContent = `TÀI KHOẢN CHỨA MÃ ẨN, Mã ẩn đó là ${randomCode}`;
}
