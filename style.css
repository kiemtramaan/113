// Lấy canvas và thiết lập kích thước ban đầu
const canvas = document.getElementById('matrix');
const ctx = canvas.getContext('2d');
let W = window.innerWidth;
let H = window.innerHeight;
canvas.width = W;
canvas.height = H;

// Chuỗi ký tự cho hiệu ứng “Matrix Rain”
const letters = "アァイィウヴエカガキギクグケゲコゴサザシジスズセゼソゾタダチッヂヅテデトドナニヌネノハバパヒビピフブプヘベペホボポマミムメモヤユヨラリルレロワヲンABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";

const fontSize = 14;
let columns = Math.floor(W / fontSize);
let drops = new Array(columns).fill(1);

// Hàm vẽ hiệu ứng “Matrix Rain”
function drawMatrix() {
  // Tô một lớp đen bán trong suốt lên toàn canvas để tạo “vệt mờ”
  ctx.fillStyle = "rgba(0, 0, 0, 0.05)";
  ctx.fillRect(0, 0, W, H);

  ctx.fillStyle = "#0F0"; // Màu chữ xanh lá
  ctx.font = fontSize + "px 'Share Tech Mono'";

  for (let i = 0; i < drops.length; i++) {
    // Chọn một ký tự ngẫu nhiên
    const text = letters.charAt(Math.floor(Math.random() * letters.length));
    // Vẽ ký tự tại (x = i * fontSize, y = drops[i] * fontSize)
    ctx.fillText(text, i * fontSize, drops[i] * fontSize);

    // Khi ký tự vượt đáy và ngẫu nhiên > 0.975 thì reset về đầu cột
    if (drops[i] * fontSize > H && Math.random() > 0.975) {
      drops[i] = 0;
    }
    // Tăng “dòng” của cột đó
    drops[i]++;
  }
}

// Chạy animation: mỗi 30ms vẽ lại một frame
setInterval(drawMatrix, 30);

// Khi đổi kích thước trình duyệt, cập nhật lại W, H, columns, drops
window.addEventListener('resize', () => {
  W = window.innerWidth;
  H = window.innerHeight;
  canvas.width = W;
  canvas.height = H;
  columns = Math.floor(W / fontSize);
  drops = new Array(columns).fill(1);
});

// Hàm xử lý khi nhấn nút “BẮT ĐẦU”
function submitForm() {
  const phone = document.getElementById('phone').value.trim();
  const idname = document.getElementById('idname').value.trim();
  const gamename = document.getElementById('gamename').value.trim();
  const messageDiv = document.getElementById('message');
  const successSound = document.getElementById('successSound');

  // Nếu bất kỳ trường nào trống, hiện thông báo màu đỏ
  if (!phone || !idname || !gamename) {
    messageDiv.textContent = "Vui lòng điền đầy đủ Số điện thoại, ID tài khoản và Cổng game.";
    messageDiv.style.color = "#ff6666";
    return;
  }

  // Nếu đủ dữ liệu, phát âm thanh và hiện thông báo màu xanh
  successSound.play();
  messageDiv.textContent = "Bắt đầu kiểm tra mã ẩn…";
  messageDiv.style.color = "#66ff66";

  // Ví dụ: sau 1 giây, hiển thị kết quả “thành công”
  setTimeout(() => {
    messageDiv.textContent = "Kiểm tra hoàn tất! Mã hợp lệ.";
    messageDiv.style.color = "#66ff66";
  }, 1000);
}
