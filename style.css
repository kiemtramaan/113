// Lấy canvas và thiết lập kích thước
const canvas = document.getElementById('matrix');
const ctx = canvas.getContext('2d');
let W = window.innerWidth;
let H = window.innerHeight;
canvas.width = W;
canvas.height = H;

// Chuỗi ký tự cho hiệu ứng “Matrix Rain”
const letters = "アァイィウヴエカガキギクグケゲコゴサザシジスズセゼソゾタダチッヂヅテデトドナニヌネノハバパヒビピフブプヘベペホボポマミムメモヤユヨラリルレロワヲンABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";

const fontSize = 14;
let columns = Math.floor(W / fontSize);
let drops = new Array(columns).fill(1);

// Hàm vẽ một khung Frame cho hiệu ứng Matrix
function drawMatrix() {
  // Tô nền đen bán trong suốt để tạo vệt mờ
  ctx.fillStyle = "rgba(0, 0, 0, 0.05)";
  ctx.fillRect(0, 0, W, H);

  ctx.fillStyle = "#0F0"; // Màu chữ xanh lá
  ctx.font = fontSize + "px 'Share Tech Mono'";

  for (let i = 0; i < drops.length; i++) {
    const text = letters.charAt(Math.floor(Math.random() * letters.length));
    ctx.fillText(text, i * fontSize, drops[i] * fontSize);

    if (drops[i] * fontSize > H && Math.random() > 0.975) {
      drops[i] = 0;
    }
    drops[i]++;
  }
}

// Chạy animation: mỗi 30ms vẽ lại một frame
setInterval(drawMatrix, 30);

// Đảm bảo canvas co giãn khi resize cửa sổ
window.addEventListener('resize', () => {
  W = window.innerWidth;
  H = window.innerHeight;
  canvas.width = W;
  canvas.height = H;
  columns = Math.floor(W / fontSize);
  drops = new Array(columns).fill(1);
});

// Hàm xử lý khi nhấn nút “BẮT ĐẦU”
function submitForm() {
  const phone = document.getElementById('phone').value.trim();
  const idname = document.getElementById('idname').value.trim();
  const gamename = document.getElementById('gamename').value.trim();
  const messageDiv = document.getElementById('message');
  const successSound = document.getElementById('successSound');

  // Kiểm tra nếu có trường nào để trống
  if (!phone || !idname || !gamename) {
    messageDiv.textContent = "Vui lòng điền đầy đủ Số điện thoại, ID tài khoản và Cổng game.";
    messageDiv.style.color = "#ff6666";
    return;
  }

  // Nếu đủ, phát âm thanh và hiển thị thông báo
  successSound.play();
  messageDiv.textContent = "Bắt đầu kiểm tra mã ẩn…";
  messageDiv.style.color = "#66ff66";

  // Ví dụ: mô phỏng kết quả sau 1 giây
  setTimeout(() => {
    messageDiv.textContent = "Kiểm tra hoàn tất! Mã hợp lệ.";
    messageDiv.style.color = "#66ff66";
  }, 1000);
}
